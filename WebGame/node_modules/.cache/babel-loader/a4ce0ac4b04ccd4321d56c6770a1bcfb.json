{"ast":null,"code":"var _jsxFileName = \"/home/stud5c/Scrivania/KikisKey/WebGame/src/screens/Gioca/Gioca.js\",\n    _s = $RefreshSig$();\n\nimport \"./Gioca.css\";\nimport React from \"react\";\nimport { useRef, useContext, useEffect, useState } from \"react\";\nimport { motion } from \"framer-motion\";\nimport { ToastContainer } from \"react-toastify\"; //importo componenti\n\nimport Character from \"../../Components/Character/Character\";\nimport Stanza from \"../../Components/Stanza/Stanza\";\nimport Oggetto from \"../../Components/Oggetto/Oggetto\";\nimport PauseMenu from \"../../Components/PauseManu/PauseManu\";\nimport Inventario from \"../../Components/Inventario/Inventario\";\nimport Mani from \"../../Components/Mani/Mani\";\nimport MisteriosoScreen from \"../../Components/MisteriosoScreen/MisteriosoScreen\";\nimport QuizScreen from \"../../Components/QuizScreen/QuizScreen\";\nimport DistributoreScreen from \"../../Components/DistributoreScreen/DistributoreScreen\"; //importo custom hooks\n\nimport { gameContext } from \"../../Hooks/useContext\";\nimport useClamp from \"../../Hooks/useClamp\";\nimport usePlayer from \"../../Hooks/usePlayer\";\nimport useStanze from \"../../Hooks/useStanze\";\nimport usePauseMenu from \"../../Hooks/usePauseMenu\";\nimport useInventario from \"../../Hooks/useInventario\";\nimport useMani from \"../../Hooks/useMani\";\nimport useQuizScreen from \"../../Hooks/useQuizScreen\";\nimport useInteract from \"../../Hooks/useInteract\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Gioca = () => {\n  _s();\n\n  // creo le variabili e le funzionni passati dai custom hooks importati\n  const {\n    gameData,\n    playerRef,\n    stanzaLayer1Ref,\n    stanzaLayer2Ref,\n    showMisteriosoScreen,\n    showQuizScreen,\n    showDistributoreScreen\n  } = useContext(gameContext);\n  const {\n    clamp\n  } = useClamp();\n  const {\n    setPlayer,\n    getPlayer,\n    playerController\n  } = usePlayer();\n  const {\n    getStanzaCorrente\n  } = useStanze();\n  const {\n    showPauseMenu,\n    pauseMenuController\n  } = usePauseMenu(\"escape\");\n  const {\n    showInventario,\n    inventarioController\n  } = useInventario(\"e\");\n  const {\n    maniController\n  } = useMani();\n  const {\n    QuizScreenController\n  } = useQuizScreen(\" \");\n  const {\n    interactController\n  } = useInteract(\" \"); // creo varibili appartenenti a quello componente\n\n  const canvasRef = useRef(null);\n  const monetaComuneRef = useRef(null);\n  const finestraRottaRef = useRef(null);\n  useEffect(() => {\n    const ctx = canvasRef.current.getContext(\"2d\");\n    const canvasWidth = ctx.canvas.width;\n    const canvasHeight = ctx.canvas.height;\n    const gameLoop = setInterval(() => {\n      //clear the transformations and clear the canvas\n      ctx.setTransform(1, 0, 0, 1, 0, 0);\n      ctx.clearRect(0, 0, canvasWidth, canvasHeight); // player is clamped to the world boundaries - don't let the player leave\n\n      setPlayer(\"x\", clamp(getPlayer(\"x\"), getStanzaCorrente().dim.minX, getStanzaCorrente().dim.maxX - getPlayer(\"size\") * 2));\n      setPlayer(\"y\", clamp(getPlayer(\"y\"), getStanzaCorrente().dim.minY, getStanzaCorrente().dim.maxY - getPlayer(\"size\") * 2));\n      console.log(\"x: \" + getPlayer(\"x\") + \" y: \" + getPlayer(\"y\"));\n      let camX = clamp(getPlayer(\"x\") - canvasWidth / 2, getStanzaCorrente().dim.minX, getStanzaCorrente().dim.maxX - canvasWidth);\n      let camY = clamp(getPlayer(\"y\") - canvasHeight / 2, getStanzaCorrente().dim.minY, getStanzaCorrente().dim.maxY - canvasHeight);\n      ctx.translate(-camX, -camY); //draw here\n\n      ctx.drawImage(stanzaLayer1Ref.current, 96, 96);\n\n      if (getStanzaCorrente().name === \"aula1\" && gameData.current.monetaComuneRaccolta === false) {\n        ctx.drawImage(monetaComuneRef.current, 790, 700);\n      }\n\n      if (getStanzaCorrente().name === \"corridoio\" && gameData.current.finestraRotta === true) {\n        ctx.drawImage(finestraRottaRef.current, 2780, 960);\n      }\n\n      ctx.drawImage(playerRef.current, getPlayer(\"x\"), getPlayer(\"y\"));\n      ctx.drawImage(stanzaLayer2Ref.current, 0, 0);\n    }, 1000 / 60);\n    return () => {\n      clearInterval(gameLoop);\n    };\n  });\n  useEffect(() => {\n    const gameController = event => {\n      let pressedKey = event.key.toLowerCase();\n      pauseMenuController(pressedKey);\n\n      if (!showPauseMenu) {\n        if (!showQuizScreen && !showMisteriosoScreen) {\n          playerController(pressedKey);\n          inventarioController(pressedKey);\n          maniController(pressedKey);\n        }\n\n        QuizScreenController(pressedKey, getPlayer(\"x\"), getPlayer(\"y\"));\n        interactController(pressedKey, getPlayer(\"x\"), getPlayer(\"y\"));\n      }\n    };\n\n    window.addEventListener(\"keydown\", gameController);\n    return () => window.removeEventListener(\"keydown\", gameController);\n  }, [showPauseMenu, showQuizScreen, showMisteriosoScreen]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(motion.div, {\n      initial: {\n        opacity: 0\n      },\n      animate: {\n        opacity: 1\n      },\n      exit: {\n        opacity: 0\n      },\n      className: \"contenitoreGioco\",\n      children: [showMisteriosoScreen ? /*#__PURE__*/_jsxDEV(MisteriosoScreen, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 33\n      }, this) : null, showQuizScreen ? /*#__PURE__*/_jsxDEV(QuizScreen, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 27\n      }, this) : null, showDistributoreScreen ? /*#__PURE__*/_jsxDEV(DistributoreScreen, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 35\n      }, this) : null, showInventario ? /*#__PURE__*/_jsxDEV(Inventario, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 27\n      }, this) : null, showPauseMenu ? /*#__PURE__*/_jsxDEV(PauseMenu, {\n        controller: pauseMenuController\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 26\n      }, this) : null, /*#__PURE__*/_jsxDEV(\"canvas\", {\n        className: \"canvas\",\n        ref: canvasRef,\n        width: 1152,\n        height: 672,\n        children: [/*#__PURE__*/_jsxDEV(Character, {\n          characterRef: playerRef,\n          defaultImg: \"/img/characters/kiki/down/1.png\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Stanza, {\n          defaultImg1: \"/img/stanze/chimica1/layer1.png\",\n          defaultImg2: \"/img/stanze/chimica1/layer2.png\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Oggetto, {\n          oggettoRef: monetaComuneRef,\n          img: \"/img/oggetti/monetaComune.png\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Oggetto, {\n          oggettoRef: finestraRottaRef,\n          img: \"/img/misc/finestraRotta.png\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Mani, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ToastContainer, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 150,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Gioca, \"RM53yGjWtv3iMVWTNA85H8wmTyM=\", false, function () {\n  return [useClamp, usePlayer, useStanze, usePauseMenu, useInventario, useMani, useQuizScreen, useInteract];\n});\n\n_c = Gioca;\nexport default Gioca;\n\nvar _c;\n\n$RefreshReg$(_c, \"Gioca\");","map":{"version":3,"sources":["/home/stud5c/Scrivania/KikisKey/WebGame/src/screens/Gioca/Gioca.js"],"names":["React","useRef","useContext","useEffect","useState","motion","ToastContainer","Character","Stanza","Oggetto","PauseMenu","Inventario","Mani","MisteriosoScreen","QuizScreen","DistributoreScreen","gameContext","useClamp","usePlayer","useStanze","usePauseMenu","useInventario","useMani","useQuizScreen","useInteract","Gioca","gameData","playerRef","stanzaLayer1Ref","stanzaLayer2Ref","showMisteriosoScreen","showQuizScreen","showDistributoreScreen","clamp","setPlayer","getPlayer","playerController","getStanzaCorrente","showPauseMenu","pauseMenuController","showInventario","inventarioController","maniController","QuizScreenController","interactController","canvasRef","monetaComuneRef","finestraRottaRef","ctx","current","getContext","canvasWidth","canvas","width","canvasHeight","height","gameLoop","setInterval","setTransform","clearRect","dim","minX","maxX","minY","maxY","console","log","camX","camY","translate","drawImage","name","monetaComuneRaccolta","finestraRotta","clearInterval","gameController","event","pressedKey","key","toLowerCase","window","addEventListener","removeEventListener","opacity"],"mappings":"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","sourcesContent":["import \"./Gioca.css\";\nimport React from \"react\";\nimport { useRef, useContext, useEffect, useState } from \"react\";\nimport { motion } from \"framer-motion\";\nimport { ToastContainer } from \"react-toastify\";\n\n//importo componenti\nimport Character from \"../../Components/Character/Character\";\nimport Stanza from \"../../Components/Stanza/Stanza\";\nimport Oggetto from \"../../Components/Oggetto/Oggetto\";\nimport PauseMenu from \"../../Components/PauseManu/PauseManu\";\nimport Inventario from \"../../Components/Inventario/Inventario\";\nimport Mani from \"../../Components/Mani/Mani\";\nimport MisteriosoScreen from \"../../Components/MisteriosoScreen/MisteriosoScreen\";\nimport QuizScreen from \"../../Components/QuizScreen/QuizScreen\";\nimport DistributoreScreen from \"../../Components/DistributoreScreen/DistributoreScreen\";\n\n//importo custom hooks\nimport { gameContext } from \"../../Hooks/useContext\";\nimport useClamp from \"../../Hooks/useClamp\";\nimport usePlayer from \"../../Hooks/usePlayer\";\nimport useStanze from \"../../Hooks/useStanze\";\nimport usePauseMenu from \"../../Hooks/usePauseMenu\";\nimport useInventario from \"../../Hooks/useInventario\";\nimport useMani from \"../../Hooks/useMani\";\nimport useQuizScreen from \"../../Hooks/useQuizScreen\";\n\nimport useInteract from \"../../Hooks/useInteract\";\n\nconst Gioca = () => {\n  // creo le variabili e le funzionni passati dai custom hooks importati\n  const {\n    gameData,\n    playerRef,\n    stanzaLayer1Ref,\n    stanzaLayer2Ref,\n    showMisteriosoScreen,\n    showQuizScreen,\n    showDistributoreScreen,\n  } = useContext(gameContext);\n\n  const { clamp } = useClamp();\n  const { setPlayer, getPlayer, playerController } = usePlayer();\n  const { getStanzaCorrente } = useStanze();\n\n  const { showPauseMenu, pauseMenuController } = usePauseMenu(\"escape\");\n  const { showInventario, inventarioController } = useInventario(\"e\");\n  const { maniController } = useMani();\n  const { QuizScreenController } = useQuizScreen(\" \");\n\n  const { interactController } = useInteract(\" \");\n\n  // creo varibili appartenenti a quello componente\n  const canvasRef = useRef(null);\n  const monetaComuneRef = useRef(null);\n  const finestraRottaRef = useRef(null);\n\n  useEffect(() => {\n    const ctx = canvasRef.current.getContext(\"2d\");\n    const canvasWidth = ctx.canvas.width;\n    const canvasHeight = ctx.canvas.height;\n\n    const gameLoop = setInterval(() => {\n      //clear the transformations and clear the canvas\n      ctx.setTransform(1, 0, 0, 1, 0, 0);\n      ctx.clearRect(0, 0, canvasWidth, canvasHeight);\n\n      // player is clamped to the world boundaries - don't let the player leave\n      setPlayer(\n        \"x\",\n        clamp(\n          getPlayer(\"x\"),\n          getStanzaCorrente().dim.minX,\n          getStanzaCorrente().dim.maxX - getPlayer(\"size\") * 2\n        )\n      );\n\n      setPlayer(\n        \"y\",\n        clamp(\n          getPlayer(\"y\"),\n          getStanzaCorrente().dim.minY,\n          getStanzaCorrente().dim.maxY - getPlayer(\"size\") * 2\n        )\n      );\n\n      console.log(\"x: \" + getPlayer(\"x\") + \" y: \" + getPlayer(\"y\"));\n\n      let camX = clamp(\n        getPlayer(\"x\") - canvasWidth / 2,\n        getStanzaCorrente().dim.minX,\n        getStanzaCorrente().dim.maxX - canvasWidth\n      );\n\n      let camY = clamp(\n        getPlayer(\"y\") - canvasHeight / 2,\n        getStanzaCorrente().dim.minY,\n        getStanzaCorrente().dim.maxY - canvasHeight\n      );\n\n      ctx.translate(-camX, -camY);\n\n      //draw here\n      ctx.drawImage(stanzaLayer1Ref.current, 96, 96);\n\n      if (\n        getStanzaCorrente().name === \"aula1\" &&\n        gameData.current.monetaComuneRaccolta === false\n      ) {\n        ctx.drawImage(monetaComuneRef.current, 790, 700);\n      }\n\n      if (\n        getStanzaCorrente().name === \"corridoio\" &&\n        gameData.current.finestraRotta === true\n      ) {\n        ctx.drawImage(finestraRottaRef.current, 2780, 960);\n      }\n\n      ctx.drawImage(playerRef.current, getPlayer(\"x\"), getPlayer(\"y\"));\n      ctx.drawImage(stanzaLayer2Ref.current, 0, 0);\n    }, 1000 / 60);\n\n    return () => {\n      clearInterval(gameLoop);\n    };\n  });\n\n  useEffect(() => {\n    const gameController = (event) => {\n      let pressedKey = event.key.toLowerCase();\n      pauseMenuController(pressedKey);\n\n      if (!showPauseMenu) {\n        if (!showQuizScreen && !showMisteriosoScreen) {\n          playerController(pressedKey);\n          inventarioController(pressedKey);\n          maniController(pressedKey);\n        }\n        QuizScreenController(pressedKey, getPlayer(\"x\"), getPlayer(\"y\"));\n        interactController(pressedKey, getPlayer(\"x\"), getPlayer(\"y\"));\n      }\n    };\n\n    window.addEventListener(\"keydown\", gameController);\n    return () => window.removeEventListener(\"keydown\", gameController);\n  }, [showPauseMenu, showQuizScreen, showMisteriosoScreen]);\n\n  return (\n    <div>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"contenitoreGioco\"\n      >\n        {showMisteriosoScreen ? <MisteriosoScreen /> : null}\n        {showQuizScreen ? <QuizScreen /> : null}\n        {showDistributoreScreen ? <DistributoreScreen /> : null}\n        {showInventario ? <Inventario /> : null}\n        {showPauseMenu ? <PauseMenu controller={pauseMenuController} /> : null}\n\n        <canvas className=\"canvas\" ref={canvasRef} width={1152} height={672}>\n          <Character\n            characterRef={playerRef}\n            defaultImg=\"/img/characters/kiki/down/1.png\"\n          />\n          <Stanza\n            defaultImg1=\"/img/stanze/chimica1/layer1.png\"\n            defaultImg2=\"/img/stanze/chimica1/layer2.png\"\n          />\n          <Oggetto\n            oggettoRef={monetaComuneRef}\n            img=\"/img/oggetti/monetaComune.png\"\n          />\n          <Oggetto\n            oggettoRef={finestraRottaRef}\n            img=\"/img/misc/finestraRotta.png\"\n          />\n        </canvas>\n        <Mani />\n        <ToastContainer />\n      </motion.div>\n    </div>\n  );\n};\n\nexport default Gioca;\n"]},"metadata":{},"sourceType":"module"}